<main>
    <div class="mat-progress-bar-container">
        <mat-progress-bar *ngIf="processing" mode="indeterminate"></mat-progress-bar>
    </div>  

    <header>
        <button mat-button matTooltip="Close window" class="close-window-btn" (click)="onCloseDialog()">
            <mat-icon>clear</mat-icon>
        </button>  
                
        <h1>Verify NIRA Documents</h1>

        <p>
            Please fill in all the fields that are marked required.
        </p>
    </header>

    <mat-horizontal-stepper
        [linear]="isLinear"
        [selectedIndex]="selectedIndex"
        labelPosition="bottom" 
        #stepper>

        <mat-step [stepControl]="form" [editable]="selectedIndex === 1 ? false : true">
            <ng-template matStepLabel>
                <h3>Document</h3>
                <p>Information about the document.</p>
            </ng-template>

            <form [formGroup]="form" class="form-document">

                <mat-form-field appearance="outline" class="fadeInUp _delay1ms full-width">
                    <mat-label>Document <span class="required-field">required</span></mat-label>
                    <input type="text" placeholder="Pick one" matInput formControlName="Document" [matAutocomplete]="autoDocument">
                    <mat-autocomplete #autoDocument="matAutocomplete">
                        <mat-option *ngFor="let item of filteredDocuments | async" [value]="item.Document" (click)="DocumentID = item.DocumentID; DocumentCode = item.DocumentCode">
                            {{ item.Document }}
                        </mat-option>
                    </mat-autocomplete>
                    <mat-hint>Choose from the dropdown.</mat-hint>
                    <mat-icon matSuffix>arrow_drop_down</mat-icon>                         
                    <mat-error *ngIf="form.get('Document').value && !DocumentID">{{ getDocumentErrorMessage() }}</mat-error>
                </mat-form-field>      
                
                <mat-form-field class="fadeInUp _delay1ms full-width" appearance="outline" *ngIf="DocumentID === 2 || DocumentID === 3">
                    <mat-label>Surname <span class="required-field">required</span></mat-label>
                    <input appRemoveSpaces matInput maxlength="30" formControlName="Surname" [disabled]="processing">
                    <mat-error *ngIf="form.get('Surname').invalid">{{ getSurnameErrorMessage() }}</mat-error>
                </mat-form-field>   

                <mat-form-field class="fadeInUp _delay2ms" *ngIf="DocumentID" appearance="outline">
                    <mat-label>Tracking Number <span class="required-field">required</span></mat-label>
                    <input appUppercase appRemoveSpaces matInput maxlength="20" formControlName="TrackingNumber" [disabled]="processing" >
                    <mat-error *ngIf="form.get('TrackingNumber').invalid">{{ getTrackingNumberErrorMessage() }}</mat-error>                                
                </mat-form-field>  
                
                <mat-form-field class="fadeInUp _delay2ms" appearance="outline" *ngIf="DocumentID === 1">
                    <mat-label>Enter Your NIN <span class="required-field">required</span></mat-label>
                    <input appUppercase appRemoveSpaces matInput maxlength="14" formControlName="NIN" [disabled]="processing">
                    <mat-error *ngIf="form.get('NIN').invalid">{{ getNINErrorMessage() }}</mat-error>
                </mat-form-field>                    

                <mat-form-field class="fadeInUp _delay2ms" appearance="outline" *ngIf="DocumentID === 2 || DocumentID === 3">
                    <mat-label>Date of {{ DocumentID === 2 ? 'Birth' : 'Death' }} <span class="required-field">required</span></mat-label>
                    <input matInput [matDatepicker]="dpFrom" disabled formControlName="Date">
                    <mat-datepicker-toggle matSuffix [for]="dpFrom"></mat-datepicker-toggle>
                    <mat-datepicker #dpFrom disabled="false"></mat-datepicker>
                    <mat-hint align="end">Use the icon above to choose a date</mat-hint>
                    <mat-error *ngIf="form.get('Date').invalid">Click the button in the field to choose a date.</mat-error>
                </mat-form-field>              

            </form>

            <div class="button-wrapper single-button-end">                
                <button
                    mat-raised-button 
                    [disabled]="form.invalid || !DocumentID || processing" 
                    class="next-btn" 
                    (click)="onCheckDocument()"
                    color="primary">
                    Send
                </button>
            </div>             
        </mat-step>

        <mat-step>
            <ng-template matStepLabel>
                <h3>Status</h3>
                <p>Confirmation from our office</p>                
            </ng-template>

            <section *ngIf="!processing" class="status-section" [ngClass]="{'is-valid': isValid, 'not-valid': !isValid}">
                
                <div *ngIf="!isValid">
                    
                    <p>
                        The <b>{{ form.get('Document').value }}</b> document with this
                        tracking number - <b>{{ form.get('TrackingNumber').value }}</b>
                        was <b> <span class="not-issued">not issued by any of our offices</span> </b>.
                    </p>
                    
                </div>
                
                <div *ngIf="isValid">

                   <p>
                        The <b>{{ documentInformation.Service }}</b> document with this
                        tracking number - <b>{{ form.get('TrackingNumber').value }}</b>
                        <b>
                            <span class="pending" *ngIf="documentInformation.Status === 'PENDING'"> is PENDING </span> 
                            <span class="not-issued" *ngIf="documentInformation.Status === 'REJECTED'"> was REJECTED by our office </span> 
                            <span class="issued" *ngIf="documentInformation.Status !== 'PENDING' && documentInformation.Status !== 'REJECTED'"> was issued by our office </span> 
                        </b>
                        with the following information.
                   </p>

                   <p *ngIf="documentInformation.ClientName">
                       Client: <b>{{ documentInformation.ClientName }}</b>
                   </p>

                   <p *ngIf="documentInformation.Organisation">
                       Organisation: <b>{{ documentInformation.Organisation }}</b>
                   </p>

                   <p *ngIf="documentInformation.Office">
                       Office: <b>{{ documentInformation.Office }}</b>
                   </p>

                   <p *ngIf="documentInformation.Location">
                       Location: <b>{{ documentInformation.Location }}</b>
                   </p>

                   <p *ngIf="documentInformation.Surname">
                        Surname: <b>{{ documentInformation.Surname }}</b>
                   </p>

                   <p *ngIf="documentInformation.GivenName">
                        Given Name: <b>{{ documentInformation.GivenName }}</b>
                   </p>

                   <p *ngIf="documentInformation.OtherName">
                        Other Names: <b>{{ documentInformation.OtherName }}</b>
                   </p>

                   <p *ngIf="documentInformation.DateOfBirth">
                        Date Of Birth: <b>{{ documentInformation.DateOfBirth | date :'d'}}<sup>{{ getDateSuperscript(documentInformation.DateOfBirth) }}</sup> {{ documentInformation.DateOfBirth | date :'MMMM, yyyy'}}</b>
                   </p>

                   <p *ngIf="documentInformation.DateOfDeath">
                        Date Of Death: <b>{{ documentInformation.DateOfDeath | date :'d'}}<sup>{{ getDateSuperscript(documentInformation.DateOfDeath) }}</sup> {{ documentInformation.DateOfDeath | date :'MMMM, yyyy'}}</b>
                   </p>

                   <!-- <p *ngIf="documentInformation.Status" 
                        [ngClass]="{'PENDING': documentInformation.Status,'REJECTED': documentInformation.Status,'ISSUED': documentInformation.Status}">
                        Status: <b>{{ documentInformation.Status }}</b>
                    </p>                    -->

                   <p *ngIf="documentInformation.DateOfService">
                        Date Of Issue: <b>{{ documentInformation.DateOfService | date :'d'}}<sup>{{ getDateSuperscript(documentInformation.DateOfService) }}</sup> {{ documentInformation.DateOfService | date :'MMMM, yyyy'}}</b>
                   </p>

                </div>

                <img *ngIf="isValid" class="valid-document-image fadeInRight _delay4ms" src="./assets/images/approved_4.fw.png" />

                <mat-icon *ngIf="!isValid">block</mat-icon>

            </section>    

            <div class="button-wrapper single-button-start">
                <button mat-button class="back-btn" matStepperPrevious>Back</button>
            </div>
        </mat-step>
    </mat-horizontal-stepper>    

</main>